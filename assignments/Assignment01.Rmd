---
title: "Exercises01"
author: "Roland Widmer"
date: "2023-02-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1


```{r}
library(tidyverse)
library(insuranceData)
library(plotly)
library(scales)

data(dataCar)
```
    a.  Draw barplots of the discrete variables "numclaims", "agecat" (categorized driver age), and "gender".
    
```{r}

ggplot(data = dataCar, mapping = aes(x = numclaims)) +
  geom_bar(fill = "#83b692")

ggplot(data = dataCar, mapping = aes(x = agecat)) +
  geom_bar(fill = "#F9ADA0")

ggplot(data = dataCar, mapping = aes(x = gender)) +
  geom_bar(fill = "#5B3758")
```

    b.  Draw a histogram of the vehicle value "veh_value" (in 10'000 Australian Dollars). Truncate values above 7 (this means: if a value is larger than 7, set it to 7).
    
```{r}
# use pmin instead of rowwise + min (crazy inefficient)
d <- dataCar %>% 
  rowwise %>% 
  mutate(trunc_veh_value = min(veh_value, 7))

p <- ggplot(d, aes(x = trunc_veh_value)) +
  geom_histogram(fill = "#83b692", bins = 30) +
  ggtitle("Histogram of vehicle value") +
  xlab("Price in 10'000 AUD")
p
```
  
    c.  Calculate the average number of claims per level of "agecat" and visualize the result as a scatterplot. Interpret the result.
```{r}
d <- dataCar %>% 
  group_by(agecat) %>% 
  summarise(avg_claims = mean(numclaims))

p <- ggplot(d, mapping = aes(x = agecat, y = avg_claims)) +
  geom_point(color = "black") +
  xlab("Age category, 1=youngest") +
  ggtitle("Scatterplot")
p
```
Interpretation: The higher the age category, the lower the average number of claims. Especially, age categories 5 and 6 have a lower average than the other age categories and age category has a higher average than the others.

    d.  Bin "veh_value" into quartiles and analyze its association with the number of claims as in 1c.
```{r}
d <- dataCar %>%
  mutate(quartile_rank = (veh_value,4)) %>% 
  group_by(quartile_rank) %>% 
  summarise(avg_claims = mean(numclaims))

p <- ggplot(d, mapping = aes(x = quartile_rank, y = avg_claims)) +
  geom_point(color = "black") +
  xlab("Quartile rank, 1=0.25 quartile") +
  ggtitle("Scatterplot")
p

```
Interpretation: The higher the value of the vehicle, the higher the average number of claims.

    e.  Use the "plotly" package to turn the plot from d. interactive.
```{r}
p %>% 
  ggplotly()
```

